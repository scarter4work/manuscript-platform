services:
  # Main web service
  - type: web
    name: manuscript-platform
    runtime: node
    env: node
    region: oregon
    plan: free
    buildCommand: npm install
    startCommand: node server.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: DATABASE_URL
        fromDatabase:
          name: manuscript-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: manuscript-redis
          property: connectionString
      - key: SESSION_SECRET
        generateValue: true
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_WEBHOOK_SECRET
        sync: false
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false
      - key: B2_ENDPOINT
        value: https://s3.us-east-005.backblazeb2.com
      - key: B2_REGION
        value: us-east-005
      - key: B2_ACCESS_KEY_ID
        sync: false
      - key: B2_SECRET_ACCESS_KEY
        sync: false
      - key: B2_BUCKET_MANUSCRIPTS_RAW
        value: manuscript-raw
      - key: B2_BUCKET_MANUSCRIPTS_PROCESSED
        value: manuscript-processed
      - key: B2_BUCKET_MARKETING_ASSETS
        value: manuscript-marketing-assets
      - key: B2_BUCKET_BACKUPS
        value: manuscript-platform-backups
      - key: FRONTEND_URL
        value: https://scarter4workmanuscripthub.com
      - key: EMAIL_FROM_ADDRESS
        value: noreply@scarter4workmanuscripthub.com
      - key: EMAIL_FROM_NAME
        value: ManuscriptHub
      - key: EMAIL_ADMIN_ADDRESS
        value: scarter4work@yahoo.com
      - key: EMAIL_REPLY_TO_ADDRESS
        value: support@scarter4workmanuscripthub.com
      - key: MAX_FILE_SIZE
        value: 52428800
      - key: SESSION_DURATION
        value: 1800

  # Redis service for session storage
  - type: redis
    name: manuscript-redis
    region: oregon
    plan: free
    maxmemoryPolicy: allkeys-lru
    ipAllowList: []

databases:
  - name: manuscript-db
    databaseName: manuscript_platform
    plan: free
