
> manuscript-upload-api@1.0.0 test
> cross-env NODE_ENV=test TEST_DATABASE_URL=postgresql://postgres:Bjoran32!@127.0.0.1:5432/manuscript_platform_test vitest run


 RUN  v3.2.4 /mnt/d/manuscript-platform

stdout | tests/submission-packages.test.js
[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/submission-packages.test.js

ðŸ§ª Setting up test environment...

stderr | tests/submission-packages.test.js
âŒ Failed to set up test environment: Error: connect ECONNREFUSED 127.0.0.1:5432
[90m    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16)[39m {
  errno: [33m-111[39m,
  code: [32m'ECONNREFUSED'[39m,
  syscall: [32m'connect'[39m,
  address: [32m'127.0.0.1'[39m,
  port: [33m5432[39m
}
ðŸ’¡ Ensure PostgreSQL is running on 127.0.0.1:5432
ðŸ’¡ Or set TEST_DATABASE_URL to your test database

stdout | tests/submission-packages.test.js

ðŸ§¹ Tearing down test environment...
âœ“ Test environment cleaned up


 â¯ tests/submission-packages.test.js (31 tests | 31 skipped) 7ms
   â†“ Submission Package Bundler > Package Templates > should have agent query template
   â†“ Submission Package Bundler > Package Templates > should have full manuscript template
   â†“ Submission Package Bundler > Package Templates > should have query only template
   â†“ Submission Package Bundler > Package Templates > should have contest template
   â†“ Submission Package Bundler > Package Templates > should validate required documents
   â†“ Submission Package Bundler > Package Creation > should create package with metadata
   â†“ Submission Package Bundler > Package Creation > should include document list with ordering
   â†“ Submission Package Bundler > Package Creation > should validate package has at least one document
   â†“ Submission Package Bundler > Package Creation > should allow custom package names
   â†“ Submission Package Bundler > Document Selection > should allow selecting multiple documents
   â†“ Submission Package Bundler > Document Selection > should maintain document order
   â†“ Submission Package Bundler > Document Selection > should allow reordering documents
   â†“ Submission Package Bundler > ZIP File Generation > should generate ZIP with multiple files
   â†“ Submission Package Bundler > ZIP File Generation > should prefix files with order numbers
   â†“ Submission Package Bundler > ZIP File Generation > should sanitize filenames
   â†“ Submission Package Bundler > ZIP File Generation > should support different file formats
   â†“ Submission Package Bundler > ZIP File Generation > should include metadata file in ZIP
   â†“ Submission Package Bundler > Package Duplication > should create copy of existing package
   â†“ Submission Package Bundler > Package Duplication > should increment copy counter in name
   â†“ Submission Package Bundler > Package Management > should list packages for manuscript
   â†“ Submission Package Bundler > Package Management > should update package details
   â†“ Submission Package Bundler > Package Management > should delete package
   â†“ Submission Package Bundler > Validation > should validate package has required documents
   â†“ Submission Package Bundler > Validation > should validate document exists before adding to package
   â†“ Submission Package Bundler > Validation > should prevent duplicate documents in package
   â†“ Submission Package Bundler > Download Tracking > should track download count
   â†“ Submission Package Bundler > Download Tracking > should track last downloaded timestamp
   â†“ Submission Package Bundler > Edge Cases > should handle empty package name
   â†“ Submission Package Bundler > Edge Cases > should handle very long package name
   â†“ Submission Package Bundler > Edge Cases > should handle package with only one document
   â†“ Submission Package Bundler > Edge Cases > should handle large file sizes
stdout | tests/integration/handlers/auth-handlers.test.js
[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/handlers/auth-handlers.test.js

ðŸ§ª Setting up test environment...

stderr | tests/integration/handlers/auth-handlers.test.js
âŒ Failed to set up test environment: Error: connect ECONNREFUSED 127.0.0.1:5432
[90m    at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1555:16)[39m {
  errno: [33m-111[39m,
  code: [32m'ECONNREFUSED'[39m,
  syscall: [32m'connect'[39m,
  address: [32m'127.0.0.1'[39m,
  port: [33m5432[39m
}
ðŸ’¡ Ensure PostgreSQL is running on 127.0.0.1:5432
ðŸ’¡ Or set TEST_DATABASE_URL to your test database

stdout | tests/integration/handlers/auth-handlers.test.js

ðŸ§¹ Tearing down test environment...
âœ“ Test environment cleaned up


 â¯ tests/integration/handlers/auth-handlers.test.js (53 tests | 53 skipped) 8ms
   â†“ POST /auth/register > should register a new user with valid credentials
   â†“ POST /auth/register > should reject registration with weak password
   â†“ POST /auth/register > should reject registration with invalid email
   â†“ POST /auth/register > should reject registration with duplicate email
   â†“ POST /auth/register > should hash password with bcrypt
   â†“ POST /auth/register > should normalize email to lowercase
   â†“ POST /auth/register > should create verification token
   â†“ POST /auth/register > should send verification email
   â†“ POST /auth/register > should log registration event in audit log
   â†“ POST /auth/register > should set default role to author if not specified
   â†“ POST /auth/login > should login with valid credentials
   â†“ POST /auth/login > should reject login with wrong password
   â†“ POST /auth/login > should reject login with non-existent email
   â†“ POST /auth/login > should reject login with unverified email
   â†“ POST /auth/login > should rate limit after 5 failed attempts
   â†“ POST /auth/login > should update last_login timestamp
   â†“ POST /auth/login > should create session in Redis
   â†“ POST /auth/login > should log successful login
   â†“ POST /auth/login > should log failed login attempts
   â†“ POST /auth/verify-email > should verify email with valid token
   â†“ POST /auth/verify-email > should reject invalid token
   â†“ POST /auth/verify-email > should reject expired token
   â†“ POST /auth/verify-email > should reject already used token
   â†“ POST /auth/verify-email > should handle missing token
   â†“ POST /auth/verify-email > should log email verification event
   â†“ POST /auth/request-password-reset > should create password reset token for valid email
   â†“ POST /auth/request-password-reset > should send password reset email
   â†“ POST /auth/request-password-reset > should not reveal if email does not exist (security)
   â†“ POST /auth/request-password-reset > should rate limit password reset requests
   â†“ POST /auth/request-password-reset > should normalize email to lowercase
   â†“ POST /auth/request-password-reset > should reject invalid email format
   â†“ POST /auth/request-password-reset > should handle missing email
   â†“ POST /auth/request-password-reset > should log password reset request
   â†“ POST /auth/reset-password > should reset password with valid token
   â†“ POST /auth/reset-password > should mark reset token as used
   â†“ POST /auth/reset-password > should reject weak new password
   â†“ POST /auth/reset-password > should reject invalid token
   â†“ POST /auth/reset-password > should reject expired token
   â†“ POST /auth/reset-password > should reject already used token
   â†“ POST /auth/reset-password > should hash new password with bcrypt
   â†“ POST /auth/reset-password > should log password reset event
   â†“ POST /auth/logout > should logout and destroy session
   â†“ POST /auth/logout > should clear session cookie
   â†“ POST /auth/logout > should log logout event
   â†“ GET /auth/me > should return current user with valid session
   â†“ GET /auth/me > should not return password hash
   â†“ GET /auth/me > should reject request without session
   â†“ GET /auth/me > should reject request with invalid session
   â†“ GET /auth/me > should return email verification status
   â†“ POST /auth/resend-verification > should resend verification email for unverified user
   â†“ POST /auth/resend-verification > should reject resend for already verified user
   â†“ POST /auth/resend-verification > should rate limit resend requests
   â†“ POST /auth/resend-verification > should not reveal if email does not exist (security)
