<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manuscript Analysis Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        /* Header - Always visible */
        .app-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header-title p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .user-info {
            text-align: right;
            font-size: 14px;
        }

        .user-info .user-email {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-info .user-role {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 6px 16px;
            font-size: 13px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        /* Breadcrumb - Always visible when navigating */
        .breadcrumb {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .breadcrumb-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #999;
        }

        .breadcrumb-current {
            color: #666;
            font-weight: 500;
        }

        /* Main content area */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* View containers */
        .view {
            display: none;
        }

        .view.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card styling */
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* Report/Annotated view container */
        .report-view {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Loading spinner */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #4caf50;
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        /* Upload section styling */
        .upload-section {
            text-align: center;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
            max-width: 500px;
            margin: 20px 0;
        }

        .file-input-wrapper input[type="file"] {
            display: none;
        }

        .file-input-label {
            display: block;
            padding: 40px;
            border: 3px dashed #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9ff;
        }

        .file-input-label:hover {
            background: #eef1ff;
            border-color: #764ba2;
        }

        .file-input-label.has-file {
            border-color: #4caf50;
            background: #e8f5e9;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Analysis progress styling */
        .analysis-status {
            margin-top: 20px;
        }

        .agent-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #e0e0e0;
            transition: all 0.3s;
        }

        .agent-card.running {
            border-left-color: #ffa726;
            background: #fff8e1;
        }

        .agent-card.complete {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }

        .agent-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .agent-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .agent-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .status-pending {
            background: #e0e0e0;
            color: #666;
        }

        .status-running {
            background: #ffa726;
            color: white;
            animation: pulse 2s infinite;
        }

        .status-complete {
            background: #4caf50;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        /* Summary card */
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
        }

        .stat-value {
            font-size: 3em;
            font-weight: bold;
            color: white;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.95;
            margin-top: 5px;
            color: white;
        }

        /* Agent details */
        .agent-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
            display: none;
        }

        .agent-details.visible {
            display: block;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .score-item {
            text-align: center;
        }

        .score-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .score-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .view-details-btn {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 8px 20px;
            margin-top: 10px;
            font-size: 14px;
        }

        .view-details-btn:hover {
            background: #667eea;
            color: white;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Always visible header -->
    <div class="app-header">
        <div class="header-content">
            <div class="header-title">
                <h1>üìö Manuscript Analysis Dashboard</h1>
                <p>AI-Powered Editing Suite for Authors</p>
            </div>
            <div class="user-info" id="userInfo">
                <!-- User info populated here -->
            </div>
        </div>
    </div>

    <!-- Breadcrumb navigation -->
    <nav class="breadcrumb" id="breadcrumb" style="display: none;">
        <div class="breadcrumb-content" id="breadcrumbContent">
            <!-- Breadcrumb populated dynamically -->
        </div>
    </nav>

    <!-- Main content container -->
    <div class="container">
        <!-- VIEW: Upload -->
        <div id="viewUpload" class="view active">
            <div class="card upload-section">
                <h2>Upload Your Manuscript</h2>
                
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" accept=".txt,.pdf,.docx">
                    <label for="fileInput" class="file-input-label" id="fileLabel">
                        <div style="font-size: 3em; margin-bottom: 10px;">üìÑ</div>
                        <div id="fileName">Click or drag to upload manuscript</div>
                        <div style="font-size: 0.9em; color: #666; margin-top: 10px;">
                            Supports .txt, .pdf, .docx (up to 50MB)
                        </div>
                    </label>
                </div>

                <div class="input-group">
                    <label for="genre">Genre</label>
                    <select id="genre">
                        <option value="thriller">Thriller</option>
                        <option value="romance">Romance</option>
                        <option value="fantasy">Fantasy</option>
                        <option value="sci-fi">Sci-Fi</option>
                        <option value="mystery">Mystery</option>
                        <option value="literary">Literary Fiction</option>
                        <option value="horror">Horror</option>
                        <option value="general">General</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="styleGuide">Style Guide (for Copy Editing)</label>
                    <select id="styleGuide">
                        <option value="chicago">Chicago Manual of Style</option>
                        <option value="ap">AP Style</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <button class="btn" onclick="app.uploadAndAnalyze()">
                    Upload & Start Analysis
                </button>
            </div>
        </div>

        <!-- VIEW: Analysis in Progress -->
        <div id="viewAnalysis" class="view">
            <div class="card analysis-status">
                <h2>Analysis in Progress</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <p id="progressText" style="text-align: center; margin-top: 10px; color: #666;">
                    Uploading manuscript...
                </p>

                <!-- Agent Cards -->
                <div class="agent-card" id="devAgent">
                    <div class="agent-header">
                        <div class="agent-name">üéØ Developmental Analysis</div>
                        <span class="agent-status status-pending" id="devStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Analyzing plot, characters, pacing, and structure
                    </div>
                    <div class="agent-details" id="devDetails"></div>
                    <button class="view-details-btn hidden" id="devDetailsBtn" onclick="app.toggleDetails('dev')">
                        View Details
                    </button>
                </div>

                <div class="agent-card" id="lineAgent">
                    <div class="agent-header">
                        <div class="agent-name">‚úçÔ∏è Line Editing Analysis</div>
                        <span class="agent-status status-pending" id="lineStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Reviewing prose quality and sentence structure
                    </div>
                    <div class="agent-details" id="lineDetails"></div>
                    <button class="view-details-btn hidden" id="lineDetailsBtn" onclick="app.toggleDetails('line')">
                        View Details
                    </button>
                </div>

                <div class="agent-card" id="copyAgent">
                    <div class="agent-header">
                        <div class="agent-name">üìù Copy Editing Analysis</div>
                        <span class="agent-status status-pending" id="copyStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Checking grammar, punctuation, and consistency
                    </div>
                    <div class="agent-details" id="copyDetails"></div>
                    <button class="view-details-btn hidden" id="copyDetailsBtn" onclick="app.toggleDetails('copy')">
                        View Details
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Analysis Complete (Summary) -->
        <div id="viewSummary" class="view">
            <div class="summary-card">
                <h2>‚ú® Analysis Complete!</h2>
                <p>Your manuscript has been thoroughly analyzed by our AI editing suite.</p>
                
                <div class="summary-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="overallScore">-</div>
                        <div class="stat-label">Overall Score</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalIssues">-</div>
                        <div class="stat-label">Total Issues</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="readyStatus">-</div>
                        <div class="stat-label">Publication Ready</div>
                    </div>
                </div>

                <div id="summaryMessage" style="font-size: 1.2em; margin: 20px 0;"></div>

                <button class="btn btn-secondary" onclick="app.navigate('report')">
                    üìÑ View Summary Report
                </button>
                <button class="btn btn-secondary" onclick="app.navigate('annotated')">
                    ‚úèÔ∏è View Annotated Manuscript
                </button>
                <button class="btn btn-secondary" onclick="app.generateAssets()">
                    üéØ Generate Marketing Assets
                </button>
                <button class="btn" onclick="app.downloadReports()">
                    üì• Download JSON Data
                </button>
                <button class="btn" onclick="app.navigate('upload', true)">
                    üîÑ Analyze Another Manuscript
                </button>
            </div>
        </div>

        <!-- VIEW: Summary Report -->
        <div id="viewReport" class="view">
            <div class="loading" id="reportLoading">
                <div class="spinner"></div>
                <p>Loading report...</p>
            </div>
            <div class="report-view" id="reportContent" style="display: none;">
                <!-- Report HTML injected here -->
            </div>
        </div>

        <!-- VIEW: Annotated Manuscript -->
        <div id="viewAnnotated" class="view">
            <div class="loading" id="annotatedLoading">
                <div class="spinner"></div>
                <p>Loading annotated manuscript...</p>
            </div>
            <div class="report-view" id="annotatedContent" style="display: none;">
                <!-- Annotated manuscript HTML injected here -->
            </div>
        </div>

        <!-- VIEW: Asset Generation Progress -->
        <div id="viewAssetGeneration" class="view">
            <div class="card">
                <h2>Generating Marketing Assets</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    AI is analyzing your manuscript to create Amazon KDP-optimized marketing materials...
                </p>

                <!-- Asset Agent Cards -->
                <div class="agent-card" id="bookDescAgent">
                    <div class="agent-header">
                        <div class="agent-name">üìö Book Description</div>
                        <span class="agent-status status-pending" id="bookDescStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Creating compelling book descriptions optimized for Amazon
                    </div>
                </div>

                <div class="agent-card" id="keywordAgent">
                    <div class="agent-header">
                        <div class="agent-name">üîç Keywords</div>
                        <span class="agent-status status-pending" id="keywordStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Generating 7 SEO keyword phrases for discoverability
                    </div>
                </div>

                <div class="agent-card" id="categoryAgent">
                    <div class="agent-header">
                        <div class="agent-name">üìë Categories</div>
                        <span class="agent-status status-pending" id="categoryStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Recommending BISAC categories for Amazon listing
                    </div>
                </div>

                <div class="agent-card" id="authorBioAgent">
                    <div class="agent-header">
                        <div class="agent-name">üë§ Author Bio</div>
                        <span class="agent-status status-pending" id="authorBioStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Creating professional author biographies in multiple lengths
                    </div>
                </div>

                <div class="agent-card" id="backMatterAgent">
                    <div class="agent-header">
                        <div class="agent-name">üìñ Back Matter</div>
                        <span class="agent-status status-pending" id="backMatterStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Generating book back matter with CTAs and social links
                    </div>
                </div>

                <div class="agent-card" id="coverDesignAgent">
                    <div class="agent-header">
                        <div class="agent-name">üé® Cover Design Brief</div>
                        <span class="agent-status status-pending" id="coverDesignStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Creating comprehensive cover design brief with AI art prompts
                    </div>
                </div>

                <div class="agent-card" id="seriesDescriptionAgent">
                    <div class="agent-header">
                        <div class="agent-name">üìö Series Description</div>
                        <span class="agent-status status-pending" id="seriesDescriptionStatus">Pending</span>
                    </div>
                    <div style="color: #666; font-size: 0.9em;">
                        Generating series descriptions and multi-book arc planning
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Assets Review -->
        <div id="viewAssets" class="view">
            <div class="card">
                <h2>üì¶ Marketing Assets</h2>
                <p style="color: #666; margin-bottom: 30px;">
                    Review and customize your AI-generated marketing materials for Amazon KDP.
                </p>

                <!-- Book Description Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìö Book Description</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 10px;">
                            Version:
                        </label>
                        <select id="descriptionVersion" style="padding: 10px; border-radius: 6px; border: 2px solid #e0e0e0; font-size: 16px;" onchange="app.switchDescriptionVersion()">
                            <option value="medium">Medium (250 words)</option>
                            <option value="short">Short (150 words)</option>
                            <option value="long">Long (350 words)</option>
                        </select>
                    </div>

                    <textarea id="bookDescription" style="width: 100%; min-height: 200px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; font-family: inherit; resize: vertical;"></textarea>
                    <div style="text-align: right; font-size: 14px; color: #666; margin-top: 5px;">
                        <span id="descCharCount">0</span> / 4000 characters
                    </div>
                </div>

                <!-- Keywords Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üîç Keywords (7 required)</h3>
                    <div id="keywordsList" style="display: flex; flex-direction: column; gap: 10px;">
                        <!-- Keywords populated here -->
                    </div>
                </div>

                <!-- Categories Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìë Categories</h3>
                    <div id="categoriesList">
                        <!-- Categories populated here -->
                    </div>
                </div>

                <!-- Author Bio Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üë§ Author Bio</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 10px;">
                            Bio Version:
                        </label>
                        <select id="bioVersion" style="padding: 10px; border-radius: 6px; border: 2px solid #e0e0e0; font-size: 16px;" onchange="app.switchBioVersion()">
                            <option value="medium">Medium (100 words - Amazon)</option>
                            <option value="short">Short (50 words - Brief)</option>
                            <option value="long">Long (200 words - Website)</option>
                            <option value="socialMediaBio">Social Media (160 chars)</option>
                        </select>
                    </div>

                    <textarea id="authorBio" style="width: 100%; min-height: 150px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; font-family: inherit; resize: vertical;"></textarea>
                    <div style="text-align: right; font-size: 14px; color: #666; margin-top: 5px;">
                        <span id="bioCharCount">0</span> characters
                    </div>
                </div>

                <!-- Back Matter Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìñ Back Matter</h3>

                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 10px;">
                            Format:
                        </label>
                        <select id="backMatterFormat" style="padding: 10px; border-radius: 6px; border: 2px solid #e0e0e0; font-size: 16px;" onchange="app.switchBackMatterFormat()">
                            <option value="plainText">Plain Text (for print books)</option>
                            <option value="html">HTML (for ebooks)</option>
                        </select>
                    </div>

                    <div id="backMatterPreview" style="padding: 20px; border: 2px solid #e0e0e0; border-radius: 8px; background: #f9f9f9; max-height: 400px; overflow-y: auto; font-family: Georgia, serif; white-space: pre-wrap;">
                        <!-- Back matter preview populated here -->
                    </div>

                    <details style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #667eea;">View Raw Back Matter Data</summary>
                        <pre id="backMatterRaw" style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; overflow-x: auto; font-size: 14px;">
                            <!-- Raw back matter data here -->
                        </pre>
                    </details>
                </div>

                <!-- Cover Design Brief Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üé® Cover Design Brief</h3>

                    <div style="background: #f8f9ff; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">Visual Concept</h4>
                        <div id="coverVisualConcept" style="white-space: pre-wrap;">
                            <!-- Visual concept populated here -->
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div style="background: #fff8e1; padding: 20px; border-radius: 8px;">
                            <h4 style="color: #ffa726; margin-bottom: 10px;">üé® Color Palette</h4>
                            <div id="coverColorPalette">
                                <!-- Color palette populated here -->
                            </div>
                        </div>

                        <div style="background: #e8f5e9; padding: 20px; border-radius: 8px;">
                            <h4 style="color: #4caf50; margin-bottom: 10px;">‚úíÔ∏è Typography</h4>
                            <div id="coverTypography">
                                <!-- Typography details populated here -->
                            </div>
                        </div>
                    </div>

                    <div style="background: #f3e5f5; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #9c27b0; margin-bottom: 10px;">ü§ñ AI Art Prompts</h4>
                        <div id="coverAIPrompts">
                            <!-- AI art prompts populated here -->
                        </div>
                    </div>

                    <details style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #667eea;">View Complete Design Brief</summary>
                        <div id="coverDesignBriefFull" style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px; white-space: pre-wrap;">
                            <!-- Full design brief populated here -->
                        </div>
                    </details>
                </div>

                <!-- Series Description Section -->
                <div class="asset-section" style="margin-bottom: 40px;">
                    <h3 style="color: #667eea; margin-bottom: 15px;">üìö Series Description</h3>
                    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                        <em>If your book is part of a series, use these descriptions and marketing materials</em>
                    </p>

                    <div style="background: #f8f9ff; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">‚ú® Series Tagline</h4>
                        <div id="seriesTagline" style="font-size: 1.2em; font-weight: 600; font-style: italic;">
                            <!-- Series tagline populated here -->
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; display: block; margin-bottom: 10px;">
                            Description Length:
                        </label>
                        <select id="seriesDescLength" style="padding: 10px; border-radius: 6px; border: 2px solid #e0e0e0; font-size: 16px;" onchange="app.switchSeriesDescLength()">
                            <option value="short">Short (100-150 words)</option>
                            <option value="long">Long (300-400 words)</option>
                        </select>
                    </div>

                    <div style="padding: 20px; border: 2px solid #e0e0e0; border-radius: 8px; background: #f9f9f9; min-height: 200px; white-space: pre-wrap;" id="seriesDescriptionText">
                        <!-- Series description populated here -->
                    </div>

                    <div style="background: #fff8e1; padding: 20px; border-radius: 8px; margin-top: 15px;">
                        <h4 style="color: #ffa726; margin-bottom: 10px;">üìñ Book-by-Book Arc</h4>
                        <div id="seriesBookArc">
                            <!-- Book arc populated here -->
                        </div>
                    </div>

                    <details style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px;">
                        <summary style="cursor: pointer; font-weight: 600; color: #667eea;">View Complete Series Strategy</summary>
                        <div id="seriesStrategyFull" style="margin-top: 15px; padding: 15px; background: white; border-radius: 6px;">
                            <!-- Full series strategy populated here -->
                        </div>
                    </details>
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-secondary" onclick="app.downloadAssets()">
                        üì• Download Assets (JSON)
                    </button>
                    <button class="btn btn-secondary" onclick="app.downloadAssetsText()">
                        üìÑ Download Assets (Text)
                    </button>
                    <button class="btn" onclick="app.navigate('socialMedia')">
                        üì± Create Social Media Marketing
                    </button>
                    <button class="btn" onclick="app.navigate('marketAnalysis')">
                        üìä Analyze Market
                    </button>
                    <button class="btn" onclick="app.formatManuscript()">
                        üìñ Format for Amazon KDP
                    </button>
                    <button class="btn" onclick="app.navigate('summary')">
                        ‚Üê Back to Summary
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Formatting Options -->
        <div id="viewFormatting" class="view">
            <div class="card">
                <h2>üìñ Format for Amazon KDP</h2>
                <p style="color: #666; margin-bottom: 30px;">
                    Configure your manuscript for Kindle (EPUB) and paperback (PDF) publishing.
                </p>

                <!-- Metadata Form -->
                <div style="background: #f8f9ff; padding: 25px; border-radius: 8px; margin-bottom: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">Book Metadata</h3>

                    <div class="input-group">
                        <label for="bookTitle">Book Title *</label>
                        <input type="text" id="bookTitle" placeholder="Enter book title" required>
                    </div>

                    <div class="input-group">
                        <label for="authorName">Author Name *</label>
                        <input type="text" id="authorName" placeholder="Enter author name" required>
                    </div>

                    <div class="input-group">
                        <label for="copyrightYear">Copyright Year</label>
                        <input type="number" id="copyrightYear" placeholder="2025" min="1900" max="2100">
                    </div>

                    <div class="input-group">
                        <label for="isbn">ISBN (optional)</label>
                        <input type="text" id="isbn" placeholder="978-1-234-56789-0">
                    </div>

                    <div class="input-group">
                        <label for="publisher">Publisher (optional)</label>
                        <input type="text" id="publisher" placeholder="Publisher name or 'Independent'">
                    </div>

                    <div class="input-group">
                        <label for="bookLanguage">Language</label>
                        <select id="bookLanguage">
                            <option value="en">English</option>
                            <option value="es">Spanish</option>
                            <option value="fr">French</option>
                            <option value="de">German</option>
                            <option value="it">Italian</option>
                            <option value="pt">Portuguese</option>
                        </select>
                    </div>
                </div>

                <!-- PDF Options -->
                <div style="background: #fff8e1; padding: 25px; border-radius: 8px; margin-bottom: 30px;">
                    <h3 style="color: #ffa726; margin-bottom: 20px;">üìÑ Paperback PDF Options</h3>

                    <div class="input-group">
                        <label for="trimSize">Trim Size</label>
                        <select id="trimSize">
                            <option value="5x8">5" √ó 8" (Small paperback)</option>
                            <option value="5.5x8.5">5.5" √ó 8.5" (Digest)</option>
                            <option value="6x9" selected>6" √ó 9" (Most common for novels)</option>
                            <option value="7x10">7" √ó 10" (Large format)</option>
                            <option value="8x10">8" √ó 10" (Textbook)</option>
                            <option value="8.5x11">8.5" √ó 11" (US Letter)</option>
                        </select>
                    </div>

                    <div style="margin: 20px 0;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="includeBleed" style="width: auto; margin-right: 10px;">
                            <span>
                                <strong>Include Bleed (0.125")</strong>
                                <br>
                                <span style="font-size: 0.9em; color: #666;">
                                    Required if your book has images extending to page edges
                                </span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Format Info -->
                <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h4 style="color: #4caf50; margin-bottom: 10px;">‚ú® What You'll Get:</h4>
                    <ul style="list-style: none; padding-left: 0;">
                        <li style="padding: 8px 0; border-bottom: 1px solid #c8e6c9;">
                            <strong>üì± EPUB File</strong> - For Kindle ebooks (with TOC and back matter)
                        </li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #c8e6c9;">
                            <strong>üìÑ PDF File</strong> - For paperback printing (print-ready)
                        </li>
                        <li style="padding: 8px 0; border-bottom: 1px solid #c8e6c9;">
                            <strong>üìã Front Matter</strong> - Title page and copyright page
                        </li>
                        <li style="padding: 8px 0;">
                            <strong>üìñ Back Matter</strong> - Author info and CTAs from Phase 3
                        </li>
                    </ul>
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="app.startFormatting()" style="background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); font-size: 18px; padding: 18px 50px;">
                        üöÄ Generate EPUB & PDF
                    </button>
                    <br>
                    <button class="btn" onclick="app.navigate('assets')" style="background: transparent; color: #667eea; box-shadow: none; border: 2px solid #667eea;">
                        ‚Üê Back to Assets
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Formatting in Progress -->
        <div id="viewFormattingProgress" class="view">
            <div class="card">
                <h2>üîÑ Formatting Manuscript...</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Converting your manuscript to Amazon KDP-ready formats...
                </p>

                <div class="progress-bar">
                    <div class="progress-fill" id="formattingProgressBar" style="width: 0%"></div>
                </div>
                <p id="formattingProgressText" style="text-align: center; margin-top: 15px; color: #666; font-size: 1.1em;">
                    Initializing formatter...
                </p>

                <div style="margin-top: 40px;">
                    <div class="agent-card" id="epubCard">
                        <div class="agent-header">
                            <div class="agent-name">üì± EPUB Generation</div>
                            <span class="agent-status status-pending" id="epubStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Creating Kindle-ready EPUB 3.0 file with TOC and metadata
                        </div>
                        <div id="epubDetails" style="margin-top: 10px; display: none; padding: 10px; background: #f0f0f0; border-radius: 6px;">
                            <!-- EPUB details populated here -->
                        </div>
                    </div>

                    <div class="agent-card" id="pdfCard">
                        <div class="agent-header">
                            <div class="agent-name">üìÑ PDF Generation</div>
                            <span class="agent-status status-pending" id="pdfStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Creating print-ready PDF with proper margins and formatting
                        </div>
                        <div id="pdfDetails" style="margin-top: 10px; display: none; padding: 10px; background: #f0f0f0; border-radius: 6px;">
                            <!-- PDF details populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Formatting Complete -->
        <div id="viewFormattingComplete" class="view">
            <div class="card">
                <div style="text-align: center;">
                    <div style="font-size: 5em; margin-bottom: 20px;">üéâ</div>
                    <h2 style="color: #4caf50; margin-bottom: 15px;">Formatting Complete!</h2>
                    <p style="color: #666; font-size: 1.2em; margin-bottom: 30px;">
                        Your manuscript has been formatted for Amazon KDP publishing.
                    </p>
                </div>

                <!-- File Info Cards -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 40px 0;">
                    <div style="background: #f8f9ff; padding: 25px; border-radius: 12px; border: 2px solid #667eea;">
                        <div style="font-size: 3em; text-align: center; margin-bottom: 15px;">üì±</div>
                        <h3 style="text-align: center; color: #667eea; margin-bottom: 15px;">EPUB (Kindle)</h3>
                        <div id="epubFileInfo" style="font-size: 0.95em; color: #666;">
                            <!-- EPUB file info here -->
                        </div>
                        <button class="btn" onclick="app.downloadFormatted('epub')" style="width: 100%; margin-top: 15px;">
                            üì• Download EPUB
                        </button>
                    </div>

                    <div style="background: #fff8e1; padding: 25px; border-radius: 12px; border: 2px solid #ffa726;">
                        <div style="font-size: 3em; text-align: center; margin-bottom: 15px;">üìÑ</div>
                        <h3 style="text-align: center; color: #ffa726; margin-bottom: 15px;">PDF (Paperback)</h3>
                        <div id="pdfFileInfo" style="font-size: 0.95em; color: #666;">
                            <!-- PDF file info here -->
                        </div>
                        <button class="btn-secondary btn" onclick="app.downloadFormatted('pdf')" style="width: 100%; margin-top: 15px;">
                            üì• Download PDF
                        </button>
                    </div>
                </div>

                <!-- Amazon KDP Checklist -->
                <div style="background: #e8f5e9; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="color: #4caf50; margin-bottom: 20px;">‚úÖ Amazon KDP Checklist</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <strong>For Ebook:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                <li>‚úÖ EPUB file (downloaded above)</li>
                                <li>‚úÖ Book description (from Assets)</li>
                                <li>‚úÖ 7 keywords (from Assets)</li>
                                <li>‚úÖ Categories (from Assets)</li>
                                <li>‚¨ú Cover image (upload separately)</li>
                                <li>‚¨ú Pricing</li>
                            </ul>
                        </div>
                        <div>
                            <strong>For Paperback:</strong>
                            <ul style="margin-top: 10px; padding-left: 20px;">
                                <li>‚úÖ PDF file (downloaded above)</li>
                                <li>‚úÖ Trim size (configured above)</li>
                                <li>‚úÖ Book description (from Assets)</li>
                                <li>‚úÖ 7 keywords (from Assets)</li>
                                <li>‚¨ú Cover PDF (upload separately)</li>
                                <li>‚¨ú Pricing</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Next Steps -->
                <div style="background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px;">üöÄ Next Steps:</h4>
                    <ol style="padding-left: 20px; line-height: 1.8;">
                        <li>Download both EPUB and PDF files above</li>
                        <li>Go to <a href="https://kdp.amazon.com" target="_blank" style="color: #667eea;">kdp.amazon.com</a></li>
                        <li>Create a new title (or update existing)</li>
                        <li>Upload your EPUB file for Kindle ebook</li>
                        <li>Upload your PDF file for paperback</li>
                        <li>Add your cover images</li>
                        <li>Copy marketing assets from Phase 3</li>
                        <li>Set pricing and publish!</li>
                    </ol>
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center;">
                    <button class="btn" onclick="app.navigate('assets')">
                        ‚Üê Back to Marketing Assets
                    </button>
                    <button class="btn" onclick="app.navigate('summary')">
                        üìä Back to Summary
                    </button>
                    <button class="btn" onclick="app.navigate('upload', true)">
                        üîÑ Format Another Manuscript
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Market Analysis -->
        <div id="viewMarketAnalysis" class="view">
            <div class="card">
                <div style="text-align: center;">
                    <div style="font-size: 5em; margin-bottom: 20px;">üìä</div>
                    <h2 style="color: #667eea; margin-bottom: 15px;">Amazon KDP Market Analysis</h2>
                    <p style="color: #666; font-size: 1.1em; margin-bottom: 30px;">
                        Get strategic insights to optimize your book's positioning and maximize sales potential on Amazon.
                    </p>
                </div>

                <!-- Analysis Info Cards -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 40px 0;">
                    <div style="background: #f8f9ff; padding: 25px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üéØ</div>
                        <h4 style="color: #667eea; margin-bottom: 10px;">Genre & Positioning</h4>
                        <p style="font-size: 0.9em; color: #666;">
                            Identify your book's genre, sub-genres, and market position
                        </p>
                    </div>
                    <div style="background: #fff8e1; padding: 25px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üí∞</div>
                        <h4 style="color: #ffa726; margin-bottom: 10px;">Pricing Strategy</h4>
                        <p style="font-size: 0.9em; color: #666;">
                            Get optimal ebook and paperback pricing recommendations
                        </p>
                    </div>
                    <div style="background: #e8f5e9; padding: 25px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìÅ</div>
                        <h4 style="color: #4caf50; margin-bottom: 10px;">Categories & Keywords</h4>
                        <p style="font-size: 0.9em; color: #666;">
                            Amazon BISAC categories and SEO keyword phrases
                        </p>
                    </div>
                </div>

                <!-- What You'll Get -->
                <div style="background: #f0f0f0; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">üìà Complete Market Analysis Includes:</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <ul style="padding-left: 20px; line-height: 2;">
                            <li><strong>Genre Analysis</strong> - Primary/secondary genres & tropes</li>
                            <li><strong>Pricing Strategy</strong> - Ebook & paperback pricing</li>
                            <li><strong>BISAC Categories</strong> - Up to 10 category recommendations</li>
                        </ul>
                        <ul style="padding-left: 20px; line-height: 2;">
                            <li><strong>SEO Keywords</strong> - 7 optimized keyword phrases</li>
                            <li><strong>Target Audience</strong> - Demographics & psychographics</li>
                            <li><strong>Competitive Positioning</strong> - Market gaps & launch strategy</li>
                        </ul>
                    </div>
                </div>

                <!-- Analysis Note -->
                <div style="background: #fffde7; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 30px;">
                    <p style="margin: 0; color: #666;">
                        <strong>‚è±Ô∏è Analysis Time:</strong> This comprehensive analysis takes 30-60 seconds to complete.
                        Our AI will analyze your manuscript to provide data-driven recommendations for Amazon KDP success.
                    </p>
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="app.startMarketAnalysis()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 18px; padding: 18px 50px;">
                        üìä Analyze Market
                    </button>
                    <br>
                    <button class="btn" onclick="app.navigate('assets')" style="background: transparent; color: #667eea; box-shadow: none; border: 2px solid #667eea;">
                        ‚Üê Back to Assets
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Market Analysis Progress -->
        <div id="viewMarketAnalysisProgress" class="view">
            <div class="card">
                <h2>üîÑ Analyzing Market...</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Our AI is analyzing your manuscript and market trends to provide strategic recommendations...
                </p>

                <div class="progress-bar">
                    <div class="progress-fill" id="marketAnalysisProgressBar" style="width: 0%"></div>
                </div>
                <p id="marketAnalysisProgressText" style="text-align: center; margin-top: 15px; color: #666; font-size: 1.1em;">
                    Initializing market analysis...
                </p>

                <div style="margin-top: 40px;">
                    <div class="agent-card" id="genreAnalysisCard">
                        <div class="agent-header">
                            <div class="agent-name">üéØ Genre & Positioning</div>
                            <span class="agent-status status-pending" id="genreAnalysisStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Identifying primary genre, sub-genres, and market position
                        </div>
                    </div>

                    <div class="agent-card" id="pricingAnalysisCard">
                        <div class="agent-header">
                            <div class="agent-name">üí∞ Pricing Strategy</div>
                            <span class="agent-status status-pending" id="pricingAnalysisStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Analyzing optimal pricing for ebook and paperback
                        </div>
                    </div>

                    <div class="agent-card" id="categoryAnalysisCard">
                        <div class="agent-header">
                            <div class="agent-name">üìÅ Categories</div>
                            <span class="agent-status status-pending" id="categoryAnalysisStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Recommending best BISAC categories for visibility
                        </div>
                    </div>

                    <div class="agent-card" id="keywordAnalysisCard">
                        <div class="agent-header">
                            <div class="agent-name">üîç Keywords</div>
                            <span class="agent-status status-pending" id="keywordAnalysisStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Generating SEO-optimized Amazon keyword phrases
                        </div>
                    </div>

                    <div class="agent-card" id="audienceAnalysisCard">
                        <div class="agent-header">
                            <div class="agent-name">üë• Target Audience</div>
                            <span class="agent-status status-pending" id="audienceAnalysisStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Profiling ideal readers and demographics
                        </div>
                    </div>

                    <div class="agent-card" id="positioningAnalysisCard">
                        <div class="agent-header">
                            <div class="agent-name">üéØ Competitive Positioning</div>
                            <span class="agent-status status-pending" id="positioningAnalysisStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Analyzing market gaps and launch strategy
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Market Analysis Results -->
        <div id="viewMarketAnalysisResults" class="view">
            <div class="card">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 5em; margin-bottom: 20px;">üìä</div>
                    <h2 style="color: #667eea; margin-bottom: 15px;">Market Analysis Complete!</h2>
                    <p style="color: #666; font-size: 1.1em;">
                        Strategic recommendations for your Amazon KDP publishing success
                    </p>
                </div>

                <!-- Quick Summary Cards -->
                <div id="marketSummaryCards" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 30px 0;">
                    <!-- Summary cards populated here -->
                </div>

                <!-- Detailed Analysis Sections -->
                <div id="marketAnalysisDetails">
                    <!-- Detailed analysis populated here -->
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-secondary" onclick="app.downloadMarketAnalysis()">
                        üì• Download Analysis (JSON)
                    </button>
                    <button class="btn" onclick="app.navigate('assets')">
                        ‚Üê Back to Marketing Assets
                    </button>
                    <button class="btn" onclick="app.navigate('summary')">
                        üìä Back to Summary
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Social Media Marketing Entry -->
        <div id="viewSocialMedia" class="view">
            <div class="card">
                <div style="text-align: center;">
                    <div style="font-size: 5em; margin-bottom: 20px;">üì±</div>
                    <h2 style="color: #667eea; margin-bottom: 15px;">Book Launch Marketing Kit</h2>
                    <p style="color: #666; font-size: 1.1em; margin-bottom: 30px;">
                        Generate a complete social media and email marketing campaign for your book launch.
                    </p>
                </div>

                <!-- Marketing Info Cards -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 40px 0;">
                    <div style="background: #f8f9ff; padding: 25px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üì¢</div>
                        <h4 style="color: #667eea; margin-bottom: 10px;">Social Media Posts</h4>
                        <p style="font-size: 0.9em; color: #666;">
                            15+ ready-to-post content for Twitter, Facebook, Instagram & TikTok
                        </p>
                    </div>
                    <div style="background: #fff8e1; padding: 25px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìß</div>
                        <h4 style="color: #ffa726; margin-bottom: 10px;">Launch Emails</h4>
                        <p style="font-size: 0.9em; color: #666;">
                            Pre-launch, launch day, post-launch & newsletter templates
                        </p>
                    </div>
                    <div style="background: #e8f5e9; padding: 25px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìÖ</div>
                        <h4 style="color: #4caf50; margin-bottom: 10px;">Content Calendar</h4>
                        <p style="font-size: 0.9em; color: #666;">
                            30-day posting schedule with daily recommendations
                        </p>
                    </div>
                </div>

                <!-- What You'll Get -->
                <div style="background: #f0f0f0; padding: 25px; border-radius: 12px; margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px;">üéØ Complete Marketing Kit Includes:</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <ul style="padding-left: 20px; line-height: 2;">
                            <li><strong>Social Media Posts</strong> - 15+ posts across platforms</li>
                            <li><strong>Launch Emails</strong> - 4 email templates with subject lines</li>
                            <li><strong>Content Calendar</strong> - 30-day marketing schedule</li>
                        </ul>
                        <ul style="padding-left: 20px; line-height: 2;">
                            <li><strong>Book Trailer Script</strong> - 60-second video script</li>
                            <li><strong>Reader Magnets</strong> - Lead generation ideas</li>
                            <li><strong>ARC Program</strong> - Advanced reader copy strategy</li>
                        </ul>
                    </div>
                </div>

                <!-- Marketing Note -->
                <div style="background: #fffde7; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107; margin-bottom: 30px;">
                    <p style="margin: 0; color: #666;">
                        <strong>‚è±Ô∏è Generation Time:</strong> Creating your complete marketing package takes 30-60 seconds.
                        All content is customized to your book's genre and target audience.
                    </p>
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="app.startSocialMediaGeneration()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 18px; padding: 18px 50px;">
                        üöÄ Generate Marketing Kit
                    </button>
                    <br>
                    <button class="btn" onclick="app.navigate('assets')" style="background: transparent; color: #667eea; box-shadow: none; border: 2px solid #667eea;">
                        ‚Üê Back to Assets
                    </button>
                </div>
            </div>
        </div>

        <!-- VIEW: Social Media Generation Progress -->
        <div id="viewSocialMediaProgress" class="view">
            <div class="card">
                <h2>üîÑ Generating Marketing Materials...</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Creating your complete book launch marketing package...
                </p>

                <div class="progress-bar">
                    <div class="progress-fill" id="socialMediaProgressBar" style="width: 0%"></div>
                </div>
                <p id="socialMediaProgressText" style="text-align: center; margin-top: 15px; color: #666; font-size: 1.1em;">
                    Initializing marketing generator...
                </p>

                <div style="margin-top: 40px;">
                    <div class="agent-card" id="socialPostsCard">
                        <div class="agent-header">
                            <div class="agent-name">üì¢ Social Media Posts</div>
                            <span class="agent-status status-pending" id="socialPostsStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Creating 15+ posts for Twitter, Facebook, Instagram & TikTok
                        </div>
                    </div>

                    <div class="agent-card" id="emailsCard">
                        <div class="agent-header">
                            <div class="agent-name">üìß Launch Emails</div>
                            <span class="agent-status status-pending" id="emailsStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Generating email templates for pre-launch, launch & post-launch
                        </div>
                    </div>

                    <div class="agent-card" id="calendarCard">
                        <div class="agent-header">
                            <div class="agent-name">üìÖ Content Calendar</div>
                            <span class="agent-status status-pending" id="calendarStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Building 30-day marketing schedule with posting strategy
                        </div>
                    </div>

                    <div class="agent-card" id="trailerCard">
                        <div class="agent-header">
                            <div class="agent-name">üé¨ Book Trailer Script</div>
                            <span class="agent-status status-pending" id="trailerStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Creating 60-second video script with production tips
                        </div>
                    </div>

                    <div class="agent-card" id="magnetsCard">
                        <div class="agent-header">
                            <div class="agent-name">üß≤ Reader Magnets</div>
                            <span class="agent-status status-pending" id="magnetsStatus">Pending</span>
                        </div>
                        <div style="color: #666; font-size: 0.9em;">
                            Generating lead magnet ideas and ARC program strategy
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Social Media Marketing Results -->
        <div id="viewSocialMediaResults" class="view">
            <div class="card">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 5em; margin-bottom: 20px;">üéâ</div>
                    <h2 style="color: #667eea; margin-bottom: 15px;">Marketing Kit Complete!</h2>
                    <p style="color: #666; font-size: 1.1em;">
                        Your complete book launch marketing package is ready
                    </p>
                </div>

                <!-- Quick Summary Cards -->
                <div id="socialMediaSummaryCards" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin: 30px 0;">
                    <!-- Summary cards populated here -->
                </div>

                <!-- Detailed Marketing Components -->
                <div id="socialMediaDetails">
                    <!-- Detailed marketing materials populated here -->
                </div>

                <!-- Action Buttons -->
                <div style="text-align: center; margin-top: 40px;">
                    <button class="btn btn-secondary" onclick="app.downloadSocialMedia()">
                        üì• Download Marketing Kit (JSON)
                    </button>
                    <button class="btn" onclick="app.navigate('assets')">
                        ‚Üê Back to Marketing Assets
                    </button>
                    <button class="btn" onclick="app.navigate('summary')">
                        üìä Back to Summary
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Render helpers must load BEFORE dashboard-spa.js -->
    <script src="render-helpers.js"></script>
    <script src="dashboard-spa.js"></script>

    <!-- Authentication check and user info display -->
    <script>
        const API_BASE = window.location.hostname === 'localhost'
            ? 'http://localhost:8787'
            : 'https://manuscript-upload-api.scarter4work.workers.dev';

        // Check authentication on page load
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    credentials: 'include'
                });

                if (response.ok) {
                    const data = await response.json();
                    displayUserInfo(data);
                } else {
                    // Not authenticated, redirect to login
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = 'login.html';
            }
        });

        function displayUserInfo(user) {
            const userInfoDiv = document.getElementById('userInfo');
            userInfoDiv.innerHTML = `
                <div class="user-email">${user.email}</div>
                <div class="user-role">${user.role.toUpperCase()}</div>
                <button class="logout-btn" onclick="handleLogout()">Logout</button>
            `;
        }

        async function handleLogout() {
            try {
                await fetch(`${API_BASE}/auth/logout`, {
                    method: 'POST',
                    credentials: 'include'
                });
            } catch (error) {
                console.error('Logout error:', error);
            }
            // Always redirect to login after logout attempt
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
