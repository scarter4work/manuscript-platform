name = "manuscript-upload-api"
main = "worker.js"
compatibility_date = "2024-01-01"

# Enable logging
logpush = false
observability = { enabled = true }

# Queue for async analysis
[[queues.producers]]
queue = "manuscript-analysis-queue"
binding = "ANALYSIS_QUEUE"

[[queues.consumers]]
queue = "manuscript-analysis-queue"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "manuscript-analysis-dlq"

# R2 Bucket bindings
[[r2_buckets]]
binding = "MANUSCRIPTS_RAW"
bucket_name = "manuscripts-raw"

[[r2_buckets]]
binding = "MANUSCRIPTS_PROCESSED"
bucket_name = "manuscripts-processed"

[[r2_buckets]]
binding = "MARKETING_ASSETS"
bucket_name = "marketing-assets"

# Note: Custom domain is configured via Cloudflare Dashboard
# Go to Workers & Pages > manuscript-upload-api > Custom Domains
# Add: api.scarter4workmanuscripthub.com

# Environment variables (set via Cloudflare Dashboard for production)
# For local development, create a .dev.vars file with:
# ANTHROPIC_API_KEY=your_key_here
[vars]
# ANTHROPIC_API_KEY will be set via dashboard secrets for production